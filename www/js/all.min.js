function Input(e,t){this.label=e,this.value=t}function Command(e,t,o){this.icon=e,this.label=t,this.handler=o}function List(){this.items=[]}function InfiniteList(e,t){this.items=[],this.count=-1,this.retrieved=0,this.hasMore=e,this.fetchMore=t}angular.module("aima",["ionic","aima.services"]).value("about",{name:"AIMA Mobile",version:"1.0",status:"alpha"}).config(["$ionicConfigProvider","$stateProvider","$urlRouterProvider",function(e,t,o){e.views.transition("none"),t.state("test",{url:"/test",templateUrl:"views/test.html",controller:"TestCtrl"}).state("start",{url:"/start",templateUrl:"views/start.html",controller:"StartCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("help",{url:"/help",templateUrl:"views/help.html",controller:"HelpCtrl"}).state("main",{url:"/main",templateUrl:"views/main.html","abstract":!0,controller:"MainCtrl"}).state("main.home",{url:"/home",views:{menuContent:{templateUrl:"views/main-home.html",controller:"HomeCtrl"}}}).state("main.activities",{url:"/activities?year&month",views:{menuContent:{templateUrl:"views/main-activities.html",controller:"ActivitiesCtrl"}}}).state("main.activities_settings",{url:"/activities_settings",views:{menuContent:{templateUrl:"views/main-activities-settings.html",controller:"ActivitiesSettingsCtrl"}}}).state("main.activities_edit",{url:"/activities_edit/:id",views:{menuContent:{templateUrl:"views/main-activities-edit.html",controller:"ActivitiesEditCtrl"}}}).state("main.projects",{url:"/projects",views:{menuContent:{templateUrl:"views/main-projects.html",controller:"ProjectsCtrl"}}}).state("main.projects_settings",{url:"/projects_settings",views:{menuContent:{templateUrl:"views/main-projects-settings.html",controller:"ProjectsSettingsCtrl"}}}).state("main.manual",{url:"/manual",views:{menuContent:{templateUrl:"views/main-manual.html",controller:"ManualCtrl"}}}).state("main.about",{url:"/about",views:{menuContent:{templateUrl:"views/main-about.html",controller:"AboutCtrl"}}}).state("main.profile",{url:"/profile",views:{menuContent:{templateUrl:"views/main-profile.html",controller:"ProfileCtrl"}}}).state("main.projects_edit",{url:"/projects_edit","abstract":!0,views:{menuContent:{templateUrl:"views/main-projects-edit.html",controller:"ProjectEditCtrl"}}}).state("main.projects_edit.info",{url:"/info",views:{infoTab:{templateUrl:"views/main-projects-edit-info.html",controller:"ProjectEditInfoCtrl"}}}).state("main.projects_edit.tasks",{url:"/tasks",views:{tasksTab:{templateUrl:"views/main-projects-edit-tasks.html",controller:"ProjectEditTasksCtrl"}}}).state("main.projects_edit.team",{url:"/team",views:{teamTab:{templateUrl:"views/main-projects-edit-team.html",controller:"ProjectEditTeamCtrl"}}}),o.otherwise("/start")}]).controller("AppCtrl",["$rootScope",function(e){ionic.Platform.ready(function(){ionic.EventController.on("online",function(){e.$broadcast("network:online")},document),navigator.splashscreen.hide()})}]),angular.module("aima").directive("aimaNotification",["$timeout",function(e){function t(t){t.type=t.value.type,("undefined"==typeof t.type||-1===n.indexOf(t.type))&&(t.type="none"),t.head_bg=i[t.type],t.head_icon=a[t.type],t.head_ink=r,t.main_bg=l,t.main_title=s,t.main_text=d,t.title=t.value.title,t.message=t.value.message,t.visible=t.value.visible,"boolean"!=typeof t.visible&&(t.visible=!0);var o=t.value.timeout;"number"==typeof o&&o>0&&e(function(){t.visible=!1},o)}function o(e,o,n){e.$watch("value",function(o,n){t(e)})}var n=["none","info","warning","error"],i={none:"",info:"#009688",warning:"#FFC107",error:"#F44336"},a={none:"",info:"ion-information-circled",warning:"ion-alert-circled",error:"ion-close-circled"},r="#FFFFFF",l="#F0F0F0",s="#000000",d="#727272";return{scope:{value:"=?"},templateUrl:"views/aima-notification.html",link:o}}]).directive("aimaDuration",function(){function e(e,o,n){"number"!=typeof e.min&&(e.min=0),"number"!=typeof e.max&&(e.max=100),e.min>e.max&&(e.max=e.min+100),("number"!=typeof e.value||e.value<e.min||e.value>e.max)&&(e.value=e.min),("number"!=typeof e.step||e.step<=0)&&(e.step=1),("undefined"==typeof e.layout||-1===t.indexOf(e.layout))&&(e.layout="horizontal"),("undefined"==typeof e.format||-1===e.format.indexOf("{0}"))&&(e.format="{0}"),e.increment=function(){e.value+=e.step,e.value>e.max&&(e.value=e.max)},e.decrement=function(){e.value-=e.step,e.value<e.min&&(e.value=e.min)},e.replace=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,o){return"undefined"!=typeof t[o]?t[o]:e})}}var t=["horizontal","vertical"];return{restrict:"E",scope:{value:"=?",step:"=?",min:"=?",max:"=?",layout:"@?",format:"@?"},templateUrl:"views/aima-duration.html",link:e}}).directive("aimaCalendar",function(){function e(e){for(var t=moment(e).startOf("week"),o=[],n=0;7>n;n++)o.push(t.format("dd")),t.add(1,"d");return o}function t(e,t){var o=moment(e).startOf("month").startOf("week");1===o.date()&&o.add(-1,"week");for(var n=[],i=0;6>i;i++){var a=[];a.number=o.week();for(var r=0;7>r;r++)a.push({text:o.format("D"),date:o.toDate(),current:o.month()===e.getMonth(),selected:o.year()===t.getFullYear()&&o.month()===t.getMonth()&&o.date()===t.getDate()}),o=o.clone().add(1,"d");n.push(a)}return n}function o(o){o.header=moment(o.display).format("MMMM, YYYY"),o.names=e(o.display),o.weeks=t(o.display,o.value)}function n(e,t,n){("undefined"==typeof e.value||null===e.value)&&(e.value=moment().startOf("day").toDate()),("undefined"==typeof e.display||null===e.display)&&(e.display=e.value),"boolean"!=typeof e.showWeeks&&(e.showWeeks=!1),e.navigate=function(t){e.display=moment(e.display).add(t,"month").toDate()},e.select=function(t){e.value=e.display=t},e.$watch("value",function(t,n){o(e)}),e.$watch("display",function(t,n){o(e)}),o(e)}return{restrict:"E",scope:{value:"=?",display:"=?",showWeeks:"=?"},templateUrl:"views/aima-calendar.html",link:n}}),angular.module("aima").controller("HelpCtrl",["$scope",function(e){e.model={}}]),angular.module("aima").controller("LoginCtrl",["$scope","$state","$ionicLoading","$ionicHistory","identity",function(e,t,o,n,i){function a(){e.model.user.value="a",e.model.password.value="a",e.model.message="",e.model.status="content.ready"}function r(){}function l(){o.show({animation:"fade-in",templateUrl:"spinner.html"}),i.authenticate(e.model.user.value,e.model.password.value).then(function(e){null===e?s():m()})["catch"](function(e){d()})}function s(){o.hide(),e.model.message="Invalid login credentials."}function d(){o.hide(),e.model.message="Network connection error."}function m(){o.hide(),n.nextViewOptions({disableBack:!0}),t.go("main.home")}e.model={status:"loading",loading:{message:""},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",r)},user:new Input("User:",""),password:new Input("Password:",""),message:"",login:new Command(null,"Login",l)},e.$on("$ionicView.enter",function(){a()})}]),angular.module("aima").controller("AboutCtrl",["$scope","about",function(e,t){e.model={application:t.name,version:t.version+" "+t.status}}]),angular.module("aima").controller("ActivitiesEditCtrl",["$scope","$stateParams","$ionicLoading","$timeout","$q","activities","projects","$ionicModal",function(e,t,o,n,i,a,r,l){function s(){e.model.id=parseInt(t.id),e.model.message_view={visible:!1},e.model.message_edit={visible:!1},e.model.status="loading",u().then(function(){e.model.status=0===e.model.id?"edit.ready":"content.ready"})}function d(){e.model.status="loading",u().then(function(){e.model.status=0===e.model.id?"edit.ready":"content.ready"})}function m(){e.model.status="loading",e.model.activity=null,u().then(function(){e.model.status=0===e.model.id?"edit.ready":"content.ready"})}function c(){e.model.message_edit={visible:!1},e.model.status="edit.ready"}function u(){var t;t=0===e.model.id?a.create():a.load(e.model.id),t.then(function(t){e.model.activity=t,e.model.duration_h=Math.floor(e.model.activity.duration),e.model.duration_m=60*e.model.activity.duration%60,e.model.overtime_h=Math.floor(e.model.activity.overtime),e.model.overtime_m=60*e.model.activity.overtime%60});var o=r.assigned(null);o.then(function(t){e.model.projects.items=t});var n=i.all([t,o]);return n["catch"](function(e){f()}),n}function f(){e.model.status="error"}function p(){e.model.activity.duration=e.model.duration_h+Math.round(e.model.duration_m/60*100)/100,e.model.activity.overtime=e.model.overtime_h+Math.round(e.model.overtime_m/60*100)/100,v()&&(o.show({animation:"fade-in",templateUrl:"spinner.html"}),a.update(e.model.activity).then(function(t){"added"===t.status?(e.model.status="content.ready",e.model.message_view={type:"info",title:"Activity created.",timeout:5e3}):"updated"===t.status?(e.model.status="content.ready",e.model.message_view={type:"info",title:"Activity updated.",timeout:5e3}):"not-found"===t.status?(e.model.status="edit.error",e.model.message_edit={type:"error",title:"Error saving activity.",message:"Activity no longer exists."}):(e.model.status="edit.error",e.model.message_edit={type:"error",title:"Error saving activity."})})["catch"](function(){e.model.status="edit.error",e.model.message_edit={type:"error",title:"Error saving activity."}})["finally"](function(){o.hide()}))}function v(){e.model.validation={};var t=new Date;return(e.model.activity.date.getFullYear()!==t.getFullYear()||e.model.activity.date.getMonth()!==t.getMonth())&&(e.model.validation.date={error:"Invalid date."}),null===e.model.activity.project&&(e.model.validation.project={error:"Project not specified."}),null===e.model.activity.task&&(e.model.validation.task={error:"Task not specified."}),0===e.model.activity.duration?e.model.validation.duration={error:"Duration not specified."}:e.model.activity.overtime>e.model.activity.duration&&(e.model.validation.duration={error:"Overtime must be less or equal with duration."}),(null===e.model.activity.notes||0===e.model.activity.notes.trim().length)&&(e.model.validation.notes={error:"Notes not specified."}),Object.keys(e.model.validation).length>0&&(e.model.status="edit.error",e.model.message_edit={type:"error",title:" Some fields are incorrect or missing.",message:"Erros are highlighted below."}),0===Object.keys(e.model.validation).length}function g(e,t){if(null===t)return null;for(var o=0;o<e.length;o++)if(e[o].id===t.id)return e[o];return null}function h(){e.model.selectedProject=g(e.model.projects.items,e.model.activity.project),e.modalProjects.show()}function y(){e.modalProjects.hide()}function w(){if(null!==e.model.selectedProject){var t=null===e.model.activity.project?-1:e.model.activity.project.id;e.model.activity.project={id:e.model.selectedProject.id,name:e.model.selectedProject.name},t!==e.model.activity.project.id&&(e.model.activity.task=null),y()}}function k(e,t){if(null===t)return null;for(var o=0;o<e.length;o++)if(e[o].id===t.id)return e[o];return null}function j(){null!==e.model.activity.project&&(e.model.tasks.items=g(e.model.projects.items,e.model.activity.project).tasks,e.model.selectedTask=k(e.model.tasks.items,e.model.activity.task),e.modalTasks.show())}function b(){e.modalTasks.hide()}function M(){null!==e.model.selectedTask&&(e.model.activity.task={id:e.model.selectedTask.id,name:e.model.selectedTask.name},b())}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",d)},message_view:{visible:!1},message_edit:{visible:!1},reload:new Command("ion-refresh","Reload",m),edit:new Command("ion-compose","EDIT",c),save:new Command("ion-checkmark-round","SAVE",p),id:0,activity:null,duration_h:0,duration_m:0,overtime_h:0,overtime_m:0,projects:new List,tasks:new List,validation:{},openProjects:h,closeProjects:y,selectProject:w,selectedProject:null,openTasks:j,closeTasks:b,selectTask:M,selectedTask:null},l.fromTemplateUrl("views/project-selector.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modalProjects=t}),l.fromTemplateUrl("views/task-selector.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modalTasks=t}),e.$on("$ionicView.enter",function(){s()})}]),angular.module("aima").controller("ActivitiesSettingsCtrl",["$scope","settings",function(e,t){function o(){e.model.sorting=t.get("activities.sorting","ascending"),e.model.interval=t.get("activities.interval","week"),e.model.grouping=t.get("activities.grouping","day")}function n(){t.set("activities.sorting",e.model.sorting),t.set("activities.interval",e.model.interval),t.set("activities.grouping",e.model.grouping)}e.model={sorting:"ascending",interval:"week",grouping:"day"},e.$on("$ionicView.enter",function(){o()}),e.$on("$ionicView.beforeLeave",function(){n()})}]),angular.module("aima").controller("ActivitiesCtrl",["$scope","$state","$stateParams","$q","settings","activities",function(e,t,o,n,i,a){function r(){e.model.configuration.sorting=i.get("activities.sorting","ascending"),e.model.configuration.interval=i.get("activities.interval","week"),e.model.configuration.grouping=i.get("activities.grouping","day");var t="undefined"==typeof o.year?moment().year():parseInt(o.year),n="undefined"==typeof o.month?moment().month():parseInt(o.month),a="undefined"==typeof o.year?moment().day():1;switch(e.model.configuration.interval){case"week":e.model.dateFrom=moment({year:t,month:n,day:a}).startOf("week").startOf("day").toDate(),e.model.dateTo=moment({year:t,month:n,day:a}).endOf("week").startOf("day").toDate();break;case"month":e.model.dateFrom=moment({year:t,month:n,day:a}).startOf("month").startOf("day").toDate(),e.model.dateTo=moment({year:t,month:n,day:a}).endOf("month").startOf("day").toDate()}e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function l(){e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function s(){"error"===e.model.status&&(e.model.list.items.length=0),e.model.status="content.refresh",d().then(function(){e.model.status="content.ready"})["finally"](function(){e.$broadcast("scroll.refreshComplete")}),e.$digest()}function d(){var t=a.get(0,e.model.take,e.model.dateFrom,e.model.dateTo);t.then(function(t){e.model.list.items=b(t.activities,e.model.configuration.sorting,e.model.configuration.grouping),e.model.list.retrieved=t.activities.length,e.model.list.count=t.count});var o=n.all([t]);return o["catch"](function(e){m()}),o}function m(){e.model.status="error"}function c(){var t=a.get(e.model.list.retrieved,e.model.take,e.model.dateFrom,e.model.dateTo);return t.then(function(t){Array.prototype.push.apply(e.model.list.items,b(t.activities,e.model.configuration.sorting,e.model.configuration.grouping)),e.model.list.retrieved+=t.activities.length})["catch"](function(e){u()}),t}function u(){e.model.status="content.error"}function f(){return"content.error"!==e.model.status&&e.model.list.retrieved<e.model.list.count}function p(){e.model.status="content.refresh",c().then(function(){e.model.status="content.ready"})["finally"](function(){e.$broadcast("scroll.infiniteScrollComplete")})}function v(){e.model.status="content.ready"}function g(){switch(e.model.configuration.interval){case"week":e.model.dateFrom=moment(e.model.dateFrom).subtract(1,"w").toDate(),e.model.dateTo=moment(e.model.dateTo).subtract(1,"w").toDate();break;case"month":e.model.dateFrom=moment(e.model.dateFrom).subtract(1,"m").toDate(),e.model.dateTo=moment(e.model.dateTo).subtract(1,"m").toDate()}e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function h(){switch(e.model.configuration.interval){case"week":e.model.dateFrom=moment().startOf("week").startOf("day").toDate(),e.model.dateTo=moment().endOf("week").startOf("day").toDate();break;case"month":e.model.dateFrom=moment().startOf("month").startOf("day").toDate(),e.model.dateTo=moment().endOf("month").startOf("day").toDate()}e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function y(){switch(e.model.configuration.interval){case"week":e.model.dateFrom=moment(e.model.dateFrom).add(1,"w").toDate(),e.model.dateTo=moment(e.model.dateTo).add(1,"w").toDate();break;case"month":e.model.dateFrom=moment(e.model.dateFrom).add(1,"M").toDate(),e.model.dateTo=moment(e.model.dateTo).add(1,"M").toDate()}e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function w(){t.go("main.activities_edit",{id:0})}function k(e){e.header||t.go("main.activities_edit",{id:e.id})}function j(){switch(e.model.configuration.interval){case"week":return e.model.dateFrom.getMonth()===e.model.dateTo.getMonth()?moment(e.model.dateFrom).format("D")+" - "+moment(e.model.dateTo).format("D MMM YYYY"):moment(e.model.dateFrom).format("D MMM")+" - "+moment(e.model.dateTo).format("D MMM YYYY");case"month":return moment(e.model.dateFrom).format("MMM YYYY")}return"?"}function b(e,t,o){var n=[],i=null,a=null;if("none"===o){var r=e.sort(function(e,o){return e.day<o.day?"ascending"===t?-1:1:e.day>o.day?"ascending"===t?1:-1:e.project<o.project?-1:e.project>o.project?1:0});r.forEach(function(e){n.push({id:e.id,weekday:moment(e.day).format("dddd, D MMM"),project:e.project,task:e.task,duration:e.duration,overtime:e.overtime})})}else if("day"===o){var r=e.sort(function(e,o){return e.day<o.day?"ascending"===t?-1:1:e.day>o.day?"ascending"===t?1:-1:e.project<o.project?-1:e.project>o.project?1:0});r.forEach(function(e){(null===i||e.day.valueOf()!=i.valueOf())&&n.push(a={header:!0,weekday:moment(e.day).format("dddd, D MMM"),duration:0,overtime:0}),n.push({id:e.id,header:!1,day:e.day,project:e.project,task:e.task,duration:e.duration,overtime:e.overtime}),a.duration+=e.duration,a.overtime+=e.overtime,i=e.day})}else{if("project"!==o)throw new Error("Invalid arguments.");var r=e.sort(function(e,o){return e.project<o.project?-1:e.project>o.project?1:e.day<o.day?"ascending"===t?-1:1:e.day>o.day?"ascending"===t?1:-1:0});r.forEach(function(e){e.project!=i&&n.push(a={header:!0,project:e.project,duration:0,overtime:0}),n.push({id:e.id,header:!1,weekday:moment(e.day).format("dddd, D MMM"),task:e.task,duration:e.duration,overtime:e.overtime}),a.duration+=e.duration,a.overtime+=e.overtime,i=e.project})}return n}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",l)},dateFrom:new Date,dateTo:new Date,footer:j,take:20,configuration:{sorting:"ascending",interval:"week",grouping:"day"},list:new InfiniteList(f,p),refresh:s,error_more:{message:"Check your connection and try again.",retry:new Command(null,"Retry",v)},prev:new Command("ion-chevron-left",null,g),current:new Command("ion-calendar",null,h),next:new Command("ion-chevron-right",null,y),create:new Command("ion-plus-round",null,w),view:k},e.$on("$ionicView.enter",function(){r()})}]),angular.module("aima").controller("HomeCtrl",["$scope","$q","$state","activities","projects","edit-project",function(e,t,o,n,i,a){function r(){e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function l(){e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function s(){e.model.status="content.refresh",d()["finally"](function(){e.$broadcast("scroll.refreshComplete")})}function d(){var o=n.summary([new Date(2015,6,1),new Date(2015,5,1),new Date(2015,4,1)]),a=i.assigned(new Date);o.then(function(t){e.model.activities=t.sort(function(e,t){return e.month<t.month?-1:e.month>t.month?1:0}).map(function(e){return{month:e.month,interval:moment(e.month).format("MMMM, YYYY"),hours:e.hours,total:e.total}})})["catch"](function(e){}),a.then(function(t){e.model.projects=t.map(function(e){return{id:e.id,name:e.name,customer:e.customer,status:e.status}})})["catch"](function(e){});var r=t.all([o,a]);return r["catch"](function(e){m()}),r}function m(){e.model.status="error"}function c(e){o.go("main.activities",{year:e.getFullYear(),month:e.getMonth()})}function u(e){a.id=e.id,o.go("main.projects_edit.info")}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",l)},refresh:s,activities:null,projects:null,viewActivities:c,viewProject:u},e.$on("$ionicView.enter",function(){r()})}]),angular.module("aima").controller("ManualCtrl",["$scope",function(e){e.model={}}]),angular.module("aima").controller("ProfileCtrl",["$scope",function(e){e.model={}}]),angular.module("aima").factory("edit-project",[function(){return{id:0}}]).controller("ProjectEditCtrl",["$scope","$state","$ionicHistory",function(e,t,o){e.go=function(e){switch(e){case 0:t.go("main.projects_edit.info",null,{location:"replace"});break;case 1:t.go("main.projects_edit.tasks",null,{location:"replace"});break;case 2:t.go("main.projects_edit.team",null,{location:"replace"})}}}]).controller("ProjectEditInfoCtrl",["$scope","$q","projects","edit-project",function(e,t,o,n){function i(){e.model.id=n.id,e.model.status="loading",r().then(function(){e.model.status="content.ready"})}function a(){e.model.status="loading",r().then(function(){e.model.status="content.ready"})}function r(){var n=o.load(e.model.id);n.then(function(t){e.model.project=t,e.model.start=moment(e.model.project.start).fromNow(),e.model.finish=moment(e.model.project.finish).fromNow()});var i=t.all([n]);return i["catch"](function(e){l()}),i}function l(){e.model.status="error"}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",a)},id:0,project:null,start:null,finish:null},e.$on("$ionicView.enter",function(){i()})}]).controller("ProjectEditTasksCtrl",["$scope","projects","edit-project",function(e,t,o){function n(){e.model.id=o.id,e.model.status="loading",a().then(function(){e.model.status="content.ready"})}function i(){e.model.status="loading",a().then(function(){e.model.status="content.ready"})}function a(){var o=t.tasks(e.model.id);return o.then(function(t){e.model.list.items=t})["catch"](function(e){r()}),o}function r(){e.model.status="error"}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",i)},id:0,list:new List},e.$on("$ionicView.enter",function(){n()})}]).controller("ProjectEditTeamCtrl",["$scope","$q","projects","edit-project",function(e,t,o,n){function i(){e.model.id=n.id,e.model.status="loading",r().then(function(){e.model.status="content.ready"})}function a(){e.model.status="loading",r().then(function(){e.model.status="content.ready"})}function r(){var n=o.load(e.model.id);n.then(function(t){e.model.list.items=t.members.map(function(e){return{id:e.employee.id,name:e.employee.name}})});var i=t.all([n]);return i["catch"](function(e){l()}),i}function l(){e.model.status="error"}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",a)},id:0,list:new List},e.$on("$ionicView.enter",function(){i()})}]),angular.module("aima").controller("ProjectsSettingsCtrl",["$scope","settings",function(e,t){function o(){var o=t.get("projects.filtering","");o=""==o?[]:o.split(","),e.model.filtering.notstarted=0===o.length||-1!==o.indexOf("Not started"),e.model.filtering.inprogress=0===o.length||-1!==o.indexOf("In progress"),e.model.filtering.onhold=0===o.length||-1!==o.indexOf("On hold"),e.model.filtering.completed=0===o.length||-1!==o.indexOf("Completed"),e.model.filtering.cancelled=0===o.length||-1!==o.indexOf("Cancelled"),e.model.grouping=t.get("projects.grouping","none"),e.model.sorting=t.get("projects.sorting","start:ascending")}function n(){var o=[];e.model.filtering.notstarted&&o.push("Not started"),e.model.filtering.inprogress&&o.push("In progress"),e.model.filtering.onhold&&o.push("On hold"),e.model.filtering.completed&&o.push("Completed"),e.model.filtering.cancelled&&o.push("Cancelled"),5===o.length&&(o.length=0),t.set("projects.filtering",o.join(",")),t.set("projects.grouping",e.model.grouping),t.set("projects.sorting",e.model.sorting)}e.model={filtering:{notstarted:!0,inprogress:!0,onhold:!0,completed:!0,cancelled:!0},grouping:"none",sorting:"start:ascending"},e.$on("$ionicView.enter",function(){o()}),e.$on("$ionicView.beforeLeave",function(){n()})}]),angular.module("aima").controller("ProjectsCtrl",["$scope","$state","$q","settings","projects","edit-project",function(e,t,o,n,i,a){function r(){e.model.configuration.filtering=n.get("projects.filtering",""),e.model.configuration.grouping=n.get("projects.grouping","none"),e.model.configuration.sorting=n.get("projects.sorting","start:ascending"),e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function l(){e.model.status="loading",d().then(function(){e.model.status="content.ready"})}function s(){"error"===e.model.status&&(e.model.list.items.length=0),e.model.status="content.refresh",d().then(function(){e.model.status="content.ready"})["finally"](function(){e.$broadcast("scroll.refreshComplete")}),e.$digest()}function d(){e.model.date=Date.now();var t=i.assigned(e.model.date);t.then(function(t){e.model.list.items=u(t,e.model.configuration.filtering,e.model.configuration.grouping,e.model.configuration.sorting)});var n=o.all([t]);return n["catch"](function(e){m()}),n}function m(){e.model.status="error"}function c(e){e.header||(a.id=e.id,t.go("main.projects_edit.info"))}function u(e,t,o,n){var i=""==t?e:e.filter(function(e){return-1!==t.indexOf(e.status)}),a=[],r=n.split(":")[0],l=n.split(":")[1],s={"Not started":0,"In progress":1,"On hold":2,Completed:3,Cancelled:4};switch(o){case"none":a=i.sort(function(e,t){return e[r]<t[r]?"ascending"===l?-1:1:e[r]>t[r]?"ascending"===l?1:-1:0});break;case"status":i=i.sort(function(e,t){return s[e.status]<s[t.status]?-1:s[e.status]>s[t.status]?1:e[r]<t[r]?"ascending"===l?-1:1:e[r]>t[r]?"ascending"===l?1:-1:0});var d=null,m=null;i.forEach(function(e){e.status!==d&&a.push(m={count:0,header:!0,status:e.status}),a.push(e),m.count++,d=e.status})}return a.map(function(e){return e.hasOwnProperty("header")?e:{id:e.id,name:e.name,status:e.status,customer:e.customer}})}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",l)},date:null,configuration:{filtering:"",grouping:"none",sorting:"start:ascending"},list:new List,refresh:s,view:c},e.$on("$ionicView.enter",function(){r()})}]),angular.module("aima").controller("MainCtrl",["$scope","$state","$ionicHistory","identity",function(e,t,o,n){function i(){n.logout(),o.nextViewOptions({disableBack:!0}),t.go("login")}e.model={menu:[{url:"main.home",icon:"ion-home",label:"Dashboard",separator:!1},{url:"main.activities",icon:"ion-compose",label:"My Activities",separator:!1},{url:"main.projects",icon:"ion-android-folder",label:"My Projects",separator:!1},{url:"main.manual",icon:"ion-help-circled",label:"Help",separator:!1},{url:"main.about",icon:"ion-information-circled",label:"About",separator:!1},{url:"main.profile",icon:"ion-person",label:"My Profile",separator:!0}],logout:{icon:"ion-power",label:"Logout",handler:i}}}]);var ep=5;angular.module("aima.services",[]).factory("settings",["$window",function(e){var t={set:function(t,o){null===o?e.localStorage.removeItem(t):e.localStorage.setItem(t,JSON.stringify(o))},get:function(t){var o=JSON.parse(e.localStorage.getItem(t));return null===o&&2===arguments.length?arguments[1]:o}};return t}]).factory("identity",["$q","$timeout","$window","settings",function(e,t,o,n){var i={token:null,authenticate:function(n,a){var r=e.defer();return t(function(){Math.random()>ep?r.reject():"a"===n&&"a"===a?(i.token={key:123,expires:new Date(2015,7,1),user:db.employees[Math.floor(db.employees.length*Math.random())].id},o.localStorage.setItem("identity.token",JSON.stringify(i.token)),r.resolve(i.token)):(i.token=null,o.localStorage.removeItem("identity.token"),r.resolve(i.token))},1e3),r.promise},check:function(){var n=e.defer();return null===i.token&&(i.token=JSON.parse(o.localStorage.getItem("identity.tokenX"))),t(function(){Math.random()>ep?n.reject():n.resolve(null===i.token||i.token.expires<Date.now()?!1:!0)},1e3),n.promise},logout:function(){n.set("identity.token",null),i.token=null},identity:function(){var t=e.defer();return t.promise}};return i}]).factory("activities",["$q","$timeout","identity",function(e,t,o){function n(e){for(var t=0,o=moment(e).endOf("month").date(),n=0;o>n;n++)moment(e).startOf("month").add(n,"days").isoWeekday()<6&&t++;return t}var i={summary:function(o){var i=e.defer();return t(function(){if(Math.random()>ep)i.reject();else{for(var e,t=[],a=0;a<o.length;a++){e=0;for(var r=0;r<db.activities.length;r++){var l=db.activities[r];l.date.getFullYear()===o[a].getFullYear()&&l.date.getMonth()===o[a].getMonth()&&(e+=l.duration+l.overtime)}t.push({month:o[a],hours:e,total:8*n(o[a])})}i.resolve(t)}},1e3),i.promise},get:function(o,n,i,a){var r=e.defer();return t(function(){if(Math.random()>ep)r.reject();else{a=moment(a).add(1,"d").toDate();for(var e={activities:[],count:0},t=0;t<db.activities.length;t++){var l=db.activities[t];l.date>=i&&l.date<a&&(e.count++,o--<=0&&e.activities.length<n&&e.activities.push({id:l.id,day:l.date,project:l.project.name,task:l.task.name,duration:l.duration,overtime:l.overtime}))}r.resolve(e)}},1e3),r.promise},create:function(){var o=e.defer();return t(function(){Math.random()>ep?o.reject():o.resolve({id:0,date:moment(new Date).startOf("day").toDate(),project:null,task:null,duration:0,overtime:0,notes:""})},1e3),o.promise},load:function(o){var n=e.defer();return t(function(){if(Math.random()>ep)n.reject();else{for(var e=null,t=0;t<db.activities.length;t++)if(db.activities[t].id===o){e=db.activities[t];break}null===e?n.reject():n.resolve(e)}},1e3),n.promise},update:function(o){var n=e.defer();return t(function(){if(Math.random()>ep)n.reject();else if(0===o.id)o.id=++k,db.activities.push(o),n.resolve({status:"added",activity:o});else{for(var e=null,t=0;t<db.activities.length&&(e=db.activities[t],e.id!==id);t++);null===o?n.resolve({status:"not-found"}):(e.date=o.date,e.project=o.project,e.task=o.task,e.duration=o.duration,e.overtime=o.overtime,e.notes=o.notes,n.resolve({status:"updated",activity:e}))}},1e3),n.promise}};return i}]).factory("projects",["$q","$timeout","identity",function(e,t,o){var n={assigned:function(n){var i=e.defer();return t(function(){Math.random()>ep?i.reject():i.resolve(db.projects.filter(function(e){return e.members.some(function(e){return e.employee.id===o.token.user})}).map(function(e){return{id:e.id,name:e.name,status:db.project_status[e.status],start:e.start,finish:e.finish,customer:e.customer.name,tasks:e.tasks.map(function(e){return{id:e.id,name:e.name}})}}))},1e3),i.promise},load:function(o){var n=e.defer();return t(function(){if(Math.random()>ep)n.reject();else{for(var e=null,t=0;t<db.projects.length;t++)if(db.projects[t].id===o){e=db.projects[t];break}null===e?n.reject():n.resolve({id:e.id,name:e.name,status:db.project_status[e.status],start:e.start,finish:e.finish,customer:e.customer.name,members:e.members})}},1e3),n.promise},tasks:function(o){var n=e.defer();return t(function(){if(Math.random()>ep)n.reject();else{for(var e=null,t=0;t<db.projects.length;t++)if(db.projects[t].id===o){e=db.projects[t];break}null===e?n.reject():n.resolve(e.tasks)}},1e3),n.promise}};return n}]);for(var k=0,db={employees:[],customers:[],project_status:["Not started","In progress","On hold","Completed","Cancelled"],projects:[],activities:[]},e=0;200>e;e++){var employee={id:++k,name:"Jon Doe the "+e.toString()};db.employees.push(employee)}for(var c=0;100>c;c++){var customer={id:++k,name:"Happy Enterprise Father & Son Ltd. "+c.toString()};db.customers.push(customer)}for(var p=0;500>p;p++){for(var start=new Date(2014,0,1+Math.floor(365*Math.random()*2)),customer=db.customers[Math.floor(Math.random()*db.customers.length)],project={id:++k,name:"A very interesting project "+p.toString(),status:Math.floor(5*Math.random()),start:start,finish:new Date(start.getFullYear(),start.getMonth()+1+Math.floor(12*Math.random()),start.getDate()),tasks:[],
customer:{id:customer.id,name:customer.name},members:[]},tc=5+Math.floor(50*Math.random()),t=0;tc>t;t++){var task={id:++k,name:"Exciting task "+t.toString()};project.tasks.push(task)}for(var ec=2+Math.floor(25*Math.random()),e=0;ec>e;e++){var employee=db.employees[Math.floor(db.employees.length*Math.random())],member={id:++k,employee:{id:employee.id,name:employee.name},start:null,finish:null};project.members.push(member)}db.projects.push(project)}for(var d=1;366>d;d++){var date=new Date(2015,0,d);if(!(moment(date).isoWeekday()>5))for(var ac=1+Math.floor(3*Math.random()),a=0;ac>a;a++){var project=db.projects[Math.floor(Math.random()*db.projects.length)],task=project.tasks[Math.floor(Math.random()*project.tasks.length)];db.activities.push({id:++k,date:date,project:{id:project.id,name:project.name},task:{id:task.id,name:task.name},duration:Math.floor(2+4*Math.random()),overtime:Math.floor(2*Math.random()),notes:"A few notes about the activity with id "+k.toString()})}}angular.module("aima").controller("StartCtrl",["$scope","$state","$ionicHistory","identity",function(e,t,o,n){function i(){e.model.status="content.ready",l()}function a(){e.model.status="content.ready",l()}function r(){"error"===e.model.status&&(a(),e.$digest())}function l(){e.model.message="authenticating...",n.check().then(function(e){o.nextViewOptions({disableBack:!0}),t.go(e?"main.home":"login")})["catch"](function(){s()})}function s(){e.model.status="error"}e.model={status:"loading",loading:{message:"loading..."},error:{message:"Check your connection and try again.",retry:new Command(null,"Retry",a)},message:""},e.$on("$ionicView.enter",function(){i()}),e.$on("network:online",function(){r()})}]),angular.module("aima").controller("TestCtrl",["$scope",function(e){e.model={dateValue:new Date(2015,1,23),dateDisplay:new Date(2015,0,1),showWeeks:!1,durationValue:10,notification:{type:"error",title:"This is the title!",message:"The message content goes here.",visible:!0,timeout:0}},e.today=function(){e.model.dateValue=new Date},e.weeks=function(){e.model.showWeeks=!e.model.showWeeks},e.notify=function(){e.model.notification={type:"info",title:"This is the title!",message:"The message content goes here.",visible:!0,timeout:2e3}}}]).directive("aimaNotification",["$timeout",function(e){function t(t){t.type=t.value.type,("undefined"==typeof t.type||-1===n.indexOf(t.type))&&(t.type="none"),t.head_bg=i[t.type],t.head_icon=a[t.type],t.head_ink=r,t.main_bg=l,t.main_title=s,t.main_text=d,t.title=t.value.title,t.message=t.value.message,t.visible=t.value.visible,"boolean"!=typeof t.visible&&(t.visible=!0);var o=t.value.timeout;"number"==typeof o&&o>0&&e(function(){t.visible=!1},o)}function o(e,o,n){e.$watch("value",function(o,n){t(e)})}var n=["none","info","warning","error"],i={none:"",info:"#009688",warning:"#FFC107",error:"#F44336"},a={none:"",info:"ion-information-circled",warning:"ion-alert-circled",error:"ion-close-circled"},r="#FFFFFF",l="#F0F0F0",s="#000000",d="#727272";return{scope:{value:"=?"},templateUrl:"views/aima-notification.html",link:o}}]).directive("aimaDuration",function(){function e(e,o,n){"number"!=typeof e.min&&(e.min=0),"number"!=typeof e.max&&(e.max=100),e.min>e.max&&(e.max=e.min+100),("number"!=typeof e.value||e.value<e.min||e.value>e.max)&&(e.value=e.min),("number"!=typeof e.step||e.step<=0)&&(e.step=1),("undefined"==typeof e.layout||-1===t.indexOf(e.layout))&&(e.layout="horizontal"),("undefined"==typeof e.format||-1===e.format.indexOf("{0}"))&&(e.format="{0}"),e.increment=function(){e.value+=e.step,e.value>e.max&&(e.value=e.max)},e.decrement=function(){e.value-=e.step,e.value<e.min&&(e.value=e.min)},e.replace=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,o){return"undefined"!=typeof t[o]?t[o]:e})}}var t=["horizontal","vertical"];return{restrict:"E",scope:{value:"=?",step:"=?",min:"=?",max:"=?",layout:"@?",format:"@?"},templateUrl:"views/aima-duration.html",link:e}}).directive("aimaCalendar",function(){function e(e){for(var t=moment(e).startOf("week"),o=[],n=0;7>n;n++)o.push(t.format("dd")),t.add(1,"d");return o}function t(e,t){var o=moment(e).startOf("month").startOf("week");1===o.date()&&o.add(-1,"week");for(var n=[],i=0;6>i;i++){var a=[];a.number=o.week();for(var r=0;7>r;r++)a.push({text:o.format("D"),date:o.toDate(),current:o.month()===e.getMonth(),selected:o.year()===t.getFullYear()&&o.month()===t.getMonth()&&o.date()===t.getDate()}),o=o.clone().add(1,"d");n.push(a)}return n}function o(o){o.header=moment(o.display).format("MMMM, YYYY"),o.names=e(o.display),o.weeks=t(o.display,o.value)}function n(e,t,n){("undefined"==typeof e.value||null===e.value)&&(e.value=moment().startOf("day").toDate()),("undefined"==typeof e.display||null===e.display)&&(e.display=e.value),"boolean"!=typeof e.showWeeks&&(e.showWeeks=!1),e.navigate=function(t){e.display=moment(e.display).add(t,"month").toDate()},e.select=function(t){e.value=e.display=t},e.$watch("value",function(t,n){o(e)}),e.$watch("display",function(t,n){o(e)}),o(e)}return{restrict:"E",scope:{value:"=?",display:"=?",showWeeks:"=?"},templateUrl:"views/aima-calendar.html",link:n}});